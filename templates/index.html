<!-- ê²½ë¡œ : templates/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Mood2Idea</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">

  {% if step == 1 %}
    <h2>1ï¸âƒ£ ì˜¤ëŠ˜ì˜ ê°ì • ìƒ‰</h2>
    <form method="POST">
      <select name="mood_color" required>
        <option value="pink"  {% if draft.mood_color == "pink" %}selected{% endif %}>ì„¤ë ˜ (í•‘í¬)</option>
        <option value="green" {% if draft.mood_color == "green" %}selected{% endif %}>ì¦ê±°ì›€ (ì´ˆë¡)</option>
        <option value="mint"  {% if draft.mood_color == "mint" %}selected{% endif %}>í‰ì˜¨ (ë¯¼íŠ¸)</option>
        <option value="purple"{% if draft.mood_color == "purple" %}selected{% endif %}>ì™¸ë¡œì›€ (ë³´ë¼)</option>
        <option value="magenta"{% if draft.mood_color == "magenta" %}selected{% endif %}>ì„œìš´í•¨ (ìì£¼ìƒ‰)</option>
        <option value="blue"  {% if draft.mood_color == "blue" %}selected{% endif %}>ìš°ìš¸ (íŒŒë‘)</option>
        <option value="navy"  {% if draft.mood_color == "navy" %}selected{% endif %}>ì§€ì¹¨ (ë„¤ì´ë¹„)</option>
        <option value="yellow"{% if draft.mood_color == "yellow" %}selected{% endif %}>ë¶ˆì•ˆ (ë…¸ë‘)</option>
        <option value="orange"{% if draft.mood_color == "orange" %}selected{% endif %}>ì´ˆì¡°í•¨ (ì˜¤ë Œì§€)</option>
        <option value="tangerine"{% if draft.mood_color == "tangerine" %}selected{% endif %}>ì„œëŸ¬ì›€ (ì£¼í™©)</option>
        <option value="red"   {% if draft.mood_color == "red" %}selected{% endif %}>ë¶„ë…¸ (ë¹¨ê°•)</option>
        <option value="wine"  {% if draft.mood_color == "wine" %}selected{% endif %}>ë‹µë‹µí•¨ (ì™€ì¸)</option>
        <option value="black" {% if draft.mood_color == "black" %}selected{% endif %}>í˜¼ë€ (ê²€ì •)</option>
      </select>

      <button type="submit">ë‹¤ìŒ</button>
    </form>

  {% elif step == 2 %}
    <h2>2ï¸âƒ£ ê°ì • í•œ ì¤„</h2>
    <form method="POST">
      <input type="text" name="mood_text" placeholder="ì§€ê¸ˆ ê¸°ë¶„ì€?" required value="{{ draft.mood_text or '' }}">
      <button type="submit">ë‹¤ìŒ</button>
    </form>

  {% elif step == 3 %}
    <h2>3ï¸âƒ£ í‘œí˜„ ë°©ì‹</h2>
    <form method="POST">
      <label>
        <input type="radio" name="mode" value="write"
               {% if (draft.mode or 'write') == 'write' %}checked{% endif %} required>
        âœï¸ ê¸€
      </label>
      <label>
        <input type="radio" name="mode" value="draw"
               {% if draft.mode == 'draw' %}checked{% endif %}>
        ğŸ¨ ê·¸ë¦¼
      </label>
      <label>
        <input type="radio" name="mode" value="music"
               {% if draft.mode == 'music' %}checked{% endif %}>
        ğŸµ ìŒì•…
      </label>
      <button type="submit">ë‹¤ìŒ</button>
    </form>

  {% elif step == 4 %}
    <h2>4ï¸âƒ£ í‘œí˜„í•˜ê¸°</h2>

    <!-- STEP4ëŠ” draw ì—…ë¡œë“œê°€ ìˆìœ¼ë‹ˆ multipart ìœ ì§€ -->
    <form method="POST" enctype="multipart/form-data">

      {% if draft.mode == "write" %}
        <textarea name="text_content" placeholder="ê¸€ì„ ì¨ë„ ë˜ê³  ì•ˆ ì¨ë„ ë¼ìš”"></textarea>

      {% elif draft.mode == "draw" %}
        <input type="file" name="image_file" accept="image/*">
        <input type="text" name="draw_note" placeholder="ê·¸ë¦¼ì— ëŒ€í•œ ìƒê°/ëŠë‚Œ (ì„ íƒ)">

      {% elif draft.mode == "music" %}
        <!-- âœ… ìŒì•…: í‚¤ì›Œë“œë§Œ ì €ì¥ -->
        <input
          type="text"
          name="music_keywords"
          placeholder="ì˜¤ëŠ˜ì„ ëŒ€í‘œí•˜ëŠ” ìŒì•… í‚¤ì›Œë“œ (ì˜ˆ: ëª½í™˜, ë¹„ ì˜¤ëŠ” ë°¤, ë¡œíŒŒì´, ìƒˆë²½, ë¼íë§ˆë‹ˆë…¸í”„)"
        >
        <p class="hint">â€» ì¶”ì²œ/ìœ íŠœë¸Œ ê²€ìƒ‰ì€ ë‚˜ì¤‘ì—(LLM ì—°ê²°í•˜ë©´ì„œ) ë¶™ì¼ ê±°ì˜ˆìš”.</p>
      {% endif %}

      <input type="text" name="background" placeholder="ë§¥ë½/ìƒí™© (ì„ íƒ)">
      <button type="submit">ì €ì¥</button>
    </form>

  {% else %}
    <div class="page-head">
      <div>
        <h2 class="page-title">ğŸŒ™ ë‚˜ì˜ ê°ì • ë¡œê·¸</h2>
        {% if saved %}
          <p class="hint">âœ… ì €ì¥ë˜ì—ˆì–´ìš”.</p>
        {% else %}
          <p class="hint">ì˜¤ëŠ˜ì˜ ê¸°ë¡ì´ ìŒ“ì´ëŠ” ê³³ì´ì—ìš”.</p>
        {% endif %}
      </div>

      <div class="page-actions">
        <div class="view-links">
          <span class="hint">ë³´ê¸°:</span>
          <a href="{{ url_for('history', n=1) }}">ìµœê·¼ 1ê°œ</a>
          <a href="{{ url_for('history', n=5) }}">ìµœê·¼ 5ê°œ</a>
          <a href="{{ url_for('history', n=10) }}">ìµœê·¼ 10ê°œ</a>
        </div>

        <a href="{{ url_for('step1') }}">
          <button type="button">ìƒˆ ê¸°ë¡í•˜ê¸°</button>
        </a>
      </div>
    </div>

    {% if records and records|length > 0 %}
      {% for r in records %}

        {# --- mode ì•„ì´ì½˜ ê²°ì • (STEP5-1) --- #}
        {% set mode_icon = "" %}
        {% if r.mode == "write" %}{% set mode_icon = "âœï¸" %}{% endif %}
        {% if r.mode == "draw" %}{% set mode_icon = "ğŸ¨" %}{% endif %}
        {% if r.mode == "music" %}{% set mode_icon = "ğŸµ" %}{% endif %}

        <article class="record-card">
          <!-- ì¹´ë“œ í—¤ë”: ë‚ ì§œ/ì•„ì´ì½˜/ìƒ‰ -->
          <header class="record-head">
            <div class="record-meta">
              <span class="record-icon" aria-label="mode">{{ mode_icon }}</span>
              <span class="record-time">{{ r.date_time }}</span>
            </div>
            <div class="record-tags">
              <span class="tag">ìƒ‰: {{ r.mood_color }}</span>
            </div>
          </header>

          <!-- ì¹´ë“œ íƒ€ì´í‹€: ê°ì • í•œ ì¤„ -->
          <h3 class="record-title">{{ r.mood_text }}</h3>

          <!-- ì¹´ë“œ ë³¸ë¬¸: ëª¨ë“œë³„ ë‚´ìš© -->
          <section class="record-body">

            {% if r.text_content %}
              <div class="record-block">
                <div class="block-title">âœï¸ ê¸€</div>
                <div class="block-content">{{ r.text_content }}</div>
              </div>
            {% endif %}

            {% if r.draw_note %}
              <div class="record-block">
                <div class="block-title">ğŸ¨ ê·¸ë¦¼ ë©”ëª¨</div>
                <div class="block-content">{{ r.draw_note }}</div>
              </div>
            {% endif %}

            {% if r.music_keywords %}
              <div class="record-block">
                <div class="block-title">ğŸµ ìŒì•… í‚¤ì›Œë“œ</div>
                <div class="block-content">{{ r.music_keywords }}</div>
              </div>
            {% endif %}

            {% if r.background %}
              <div class="record-block subtle">
                <div class="block-title">ğŸ§© ë§¥ë½</div>
                <div class="block-content">{{ r.background }}</div>
              </div>
            {% endif %}

            {% if r.image_filename %}
              <figure class="record-media">
                <img
                  src="{{ url_for('static', filename='uploads/' + r.image_filename) }}"
                  alt="uploaded image"
                >
              </figure>
            {% endif %}

          </section>
        </article>

      {% endfor %}
    {% else %}
      <div class="empty-state">
        <p class="hint">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.</p>
        <a href="{{ url_for('step1') }}">
          <button type="button">ì²« ê¸°ë¡ ì‹œì‘í•˜ê¸°</button>
        </a>
      </div>
    {% endif %}

  {% endif %}

</div>
</body>
</html>
