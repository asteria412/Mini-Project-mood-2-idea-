<!--ê²½ë¡œ: templates/index.html-->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Mood2Idea</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">
    <h1>ğŸŒ± Mood 2 Idea</h1>
    <p>ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì•„ì´ë””ì–´ë¡œ ë‚¨ê²¨ë³´ì„¸ìš”.</p>

    <!-- [STEP 3-A] ì €ì¥ ì™„ë£Œ í‘œì‹œ (PRG redirectë¡œ ëŒì•„ì˜¨ ê²½ìš°ë§Œ) -->
    {% if saved == "1" %}
        <p style="padding:10px 12px; border:1px solid #ddd; border-radius:10px;">
            âœ… ì €ì¥ ì™„ë£Œ!
        </p>
    {% endif %}

    <!-- [NEW] ê·¸ë¦¼ ì—…ë¡œë“œ ëŒ€ë¹„: multipart/form-data -->
    <!-- [STEP 3-A] autocomplete="off" : ë¸Œë¼ìš°ì €ê°€ ì´ì „ ì…ë ¥ì„ ìë™ë³µì›í•˜ëŠ” ê±¸ ìµœëŒ€í•œ ë°©ì§€ -->
    <form id="moodForm" method="POST" enctype="multipart/form-data" autocomplete="off">
        <p>
            ğŸ¨ ì˜¤ëŠ˜ì˜ ê°ì • ìƒ‰:
            <select name="mood_color" required>
                <!-- ê¸°ì¡´ 3ê°œ + í™•ì¥ -->
                <!-- [NEW] selected ìœ ì§€: ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ mood_colorë¡œ ì„ íƒ ìœ ì§€ -->
                <option value="pink"      {% if mood_color == "pink" %}selected{% endif %}>ì„¤ë ˜ (í•‘í¬)</option>
                <option value="green"     {% if mood_color == "green" %}selected{% endif %}>ì¦ê±°ì›€ (ì´ˆë¡)</option>
                <option value="mint"      {% if mood_color == "mint" %}selected{% endif %}>í‰ì˜¨ (ë¯¼íŠ¸)</option>

                <option value="purple"    {% if mood_color == "purple" %}selected{% endif %}>ì™¸ë¡œì›€ (ë³´ë¼)</option>
                <option value="magenta"   {% if mood_color == "magenta" %}selected{% endif %}>ì„œìš´í•¨ (ìì£¼ìƒ‰)</option>

                <option value="blue"      {% if mood_color == "blue" %}selected{% endif %}>ìš°ìš¸ (íŒŒë‘)</option>
                <option value="navy"      {% if mood_color == "navy" %}selected{% endif %}>ì§€ì¹¨ (ë„¤ì´ë¹„)</option>

                <option value="yellow"    {% if mood_color == "yellow" %}selected{% endif %}>ë¶ˆì•ˆ (ë…¸ë‘)</option>
                <option value="orange"    {% if mood_color == "orange" %}selected{% endif %}>ì´ˆì¡°í•¨ (ì˜¤ë Œì§€)</option>
                <option value="tangerine" {% if mood_color == "tangerine" %}selected{% endif %}>ì„œëŸ¬ì›€ (ì£¼í™©)</option>

                <option value="red"       {% if mood_color == "red" %}selected{% endif %}>ë¶„ë…¸ (ë¹¨ê°•)</option>
                <option value="wine"      {% if mood_color == "wine" %}selected{% endif %}>ë‹µë‹µí•¨ (ì™€ì¸)</option>

                <option value="black"     {% if mood_color == "black" %}selected{% endif %}>í˜¼ë€ (ê²€ì •)</option>
            </select>
        </p>

        <p>
            âœï¸ ì˜¤ëŠ˜ì˜ ê°ì • í•œ ì¤„:
            <!-- [NEW] value ìœ ì§€ -->
            <input
                type="text"
                name="mood_text"
                placeholder="ì§€ê¸ˆ ê¸°ë¶„ì„ ì ì–´ë³´ì„¸ìš”"
                required
                value="{{ mood_text or '' }}"
                autocomplete="off"
            >
        </p>

        <!-- (STEP3ìš©) ëª¨ë“œ ë¶„ê¸° ë¼ë””ì˜¤: app.pyëŠ” ë‹¤ìŒì— -->
        <p>
            ğŸ§­ í‘œí˜„ ë°©ì‹:
            <!-- [NEW] checked ìœ ì§€: mode ê°’ìœ¼ë¡œ ìœ ì§€ -->
            <label>
                <input type="radio" name="mode" value="write"
                       {% if (mode or 'write') == "write" %}checked{% endif %}>
                âœï¸ ê¸€
            </label>

            <label>
                <input type="radio" name="mode" value="draw"
                       {% if mode == "draw" %}checked{% endif %}>
                ğŸ¨ ê·¸ë¦¼
            </label>

            <label>
                <input type="radio" name="mode" value="music"
                       {% if mode == "music" %}checked{% endif %}>
                ğŸµ ìŒì•…
            </label>
        </p>

        <!-- [NEW] ëª¨ë“œë³„ ì…ë ¥ì¹¸ì€ "ì €ì¥ ì „"ì— ë³´ì—¬ì¤˜ì•¼ í•˜ë‹ˆê¹Œ,
             í¼ ì•ˆì— í•­ìƒ ì¡´ì¬ì‹œí‚¤ê³ , JSë¡œ ë³´ì—¬ì£¼ê¸°/ìˆ¨ê¸°ê¸°ë§Œ í•¨ -->

        <!-- âœï¸ ê¸€ -->
        <div id="panel-write" class="mode-panel">
            <p>âœï¸ ê¸€ ì…ë ¥</p>
            <!-- [NEW] textarea ê°’ ìœ ì§€ -->
            <textarea name="text_content" rows="6" placeholder="ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”" autocomplete="off">{{ text_content or '' }}</textarea>

            <!-- [NEW] ë°°ê²½ ì„¤ëª…(ì„ íƒ) -->
            <p style="opacity:0.9;">ğŸ§© ì´ ê¸€ì„ ì“°ê²Œ ëœ ìƒê°/ë§¥ë½ (ì„ íƒ)</p>
            <input type="text" name="background" placeholder="ì˜ˆ: ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆëŠ”ì§€"
                   value="{{ background or '' }}" autocomplete="off">
        </div>

        <!-- ğŸ¨ ê·¸ë¦¼ -->
        <div id="panel-draw" class="mode-panel" style="display:none;">
            <p>ğŸ¨ ê·¸ë¦¼ ì—…ë¡œë“œ</p>
            <input type="file" name="image_file" accept="image/*">

            <!-- [NEW] ë°°ê²½ ì„¤ëª…(ì„ íƒ) -->
            <p style="opacity:0.9;">ğŸ§© ì´ ê·¸ë¦¼ì„ ê·¸ë¦´ ë•Œì˜ ìƒê°/ëŠë‚Œ (ì„ íƒ)</p>
            <input type="text" name="background" placeholder="ì˜ˆ: ì™œ ì´ëŸ° ìƒ‰/í˜•íƒœë¥¼ ì¼ëŠ”ì§€"
                   value="{{ background or '' }}" autocomplete="off">

            <p style="opacity:0.75;">(ì—…ë¡œë“œ ì €ì¥ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë³¸ê²© ì²˜ë¦¬í•´ë„ OK)</p>
        </div>

        <!-- ğŸµ ìŒì•… -->
        <div id="panel-music" class="mode-panel" style="display:none;">
            <p>ğŸµ ìŒì•…</p>
            <p style="opacity:0.75;">(ì¶”ì²œ ì—°ê²°ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ)</p>
        </div>

        <!-- [NEW] ì €ì¥ ë²„íŠ¼ì€ í•­ìƒ ë™ì¼ ìœ„ì¹˜/ë™ì¼ ë™ì‘ -->
        <button type="submit">ì €ì¥</button>
    </form>

    <hr>
    <h2>âœ… ì˜¤ëŠ˜ì˜ ê¸°ë¡</h2>

    <p style="opacity:0.85;">
        ë³´ê¸°:
        <a href="/?n=1">ìµœê·¼ 1ê°œ</a> |
        <a href="/?n=5">ìµœê·¼ 5ê°œ</a> |
        <a href="/?n=10">ìµœê·¼ 10ê°œ</a>
        <span style="margin-left:8px;">(í˜„ì¬ {{ today_records|length }}ê°œ)</span>
    </p>

    {% if today_records and today_records|length > 0 %}
        {% for r in today_records %}
            <div style="padding:12px 0; border-top:1px solid #eee;">
                <p>ì„ íƒí•œ ìƒ‰: <b>{{ r.mood_color }}</b></p>
                <p>ê°ì • í•œ ì¤„: <b>{{ r.mood_text }}</b></p>
                <p>í‘œí˜„ ë°©ì‹: <b>{{ r.mode }}</b></p>

                {% if r.mode == "write" and r.text_content %}
                    <p style="margin-top:12px;"><b>âœï¸ ê¸€</b></p>
                    <div style="white-space:pre-wrap;">{{ r.text_content }}</div>
                {% endif %}

                {% if r.background %}
                    <p style="margin-top:12px;"><b>ğŸ§© ë°°ê²½/ë§¥ë½</b></p>
                    <div style="white-space:pre-wrap;">{{ r.background }}</div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p style="opacity:0.75;">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.</p>
    {% endif %}
</div>

<!-- [NEW] ë¼ë””ì˜¤ ì„ íƒ ì¦‰ì‹œ íŒ¨ë„ ì „í™˜(JS) -->
<script>
(function () {
  const panels = {
    write: document.getElementById("panel-write"),
    draw: document.getElementById("panel-draw"),
    music: document.getElementById("panel-music"),
  };

  function show(mode) {
    Object.keys(panels).forEach(k => panels[k].style.display = (k === mode ? "block" : "none"));
  }

  // ì´ˆê¸° ëª¨ë“œ: ì„œë²„ì—ì„œ ë Œë”ë§ëœ checked ê¸°ì¤€ìœ¼ë¡œ ë§ì¶°ì¤Œ
  const checked = document.querySelector('input[name="mode"]:checked');
  show(checked ? checked.value : "write");

  // ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜
  document.querySelectorAll('input[name="mode"]').forEach(r => {
    r.addEventListener("change", (e) => show(e.target.value));
  });
})();
</script>

<!-- [STEP 3-A] ì €ì¥ í›„ ì…ë ¥ë¶€ ê°•ì œ ì´ˆê¸°í™”
     - ë¬¸ì œ: ë¸Œë¼ìš°ì €(íŠ¹íˆ Chrome)ê°€ redirect í›„ì—ë„ í¼ ê°’ì„ "ìë™ë³µì›"í•˜ëŠ” ê²½ìš°ê°€ ìˆìŒ
     - í•´ê²°: saved=1(ì €ì¥ ì§í›„)ì¼ ë•Œ form.reset()ìœ¼ë¡œ ì…ë ¥ë¶€ë¥¼ ê°•ì œë¡œ ë¹„ì›€ -->
<script>
(function () {
  const params = new URLSearchParams(window.location.search);
  if (params.get("saved") !== "1") return;

  const form = document.getElementById("moodForm");
  if (!form) return;

  // âœ… ë¸Œë¼ìš°ì € ìë™ë³µì›ë³´ë‹¤ ê°•í•˜ê²Œ: ì €ì¥ í›„ì—” ë¬´ì¡°ê±´ ë¹„ì›€
  form.reset();

  // âœ… ê¸°ë³¸ ëª¨ë“œëŠ” writeë¡œ (ì›í•˜ë©´ ì—¬ê¸° ë°”ê¿”ë„ ë¨)
  const writeRadio = form.querySelector('input[name="mode"][value="write"]');
  if (writeRadio) writeRadio.checked = true;

  // íŒ¨ë„ ì „í™˜ë„ ì¦‰ì‹œ ë°˜ì˜ (ê¸€ íŒ¨ë„ ë³´ì´ê²Œ)
  const panelWrite = document.getElementById("panel-write");
  const panelDraw = document.getElementById("panel-draw");
  const panelMusic = document.getElementById("panel-music");
  if (panelWrite && panelDraw && panelMusic) {
    panelWrite.style.display = "block";
    panelDraw.style.display = "none";
    panelMusic.style.display = "none";
  }
})();
</script>

<!-- [STEP 3-A] ì €ì¥ í›„ ìƒˆë¡œê³ ì¹¨ ê²½ê³  ì œê±°
     - í¼ì´ ìˆ˜ì •ë˜ë©´ "dirty"
     - ì €ì¥(submit)í•˜ë©´ dirty í•´ì œ
     - PRG redirectë¡œ ëŒì•„ì˜¨(saved=1) ê²½ìš°ì—ë„ dirty í•´ì œ -->
<script>
(function () {
  const form = document.getElementById("moodForm");
  if (!form) return;

  let dirty = false;

  // ì…ë ¥ ë³€ê²½ ì‹œ dirty
  form.addEventListener("input", () => { dirty = true; });

  // ì €ì¥ ë²„íŠ¼ ëˆŒëŸ¬ ì œì¶œí•˜ë©´ dirty í•´ì œ
  form.addEventListener("submit", () => { dirty = false; });

  // saved=1ë¡œ ëŒì•„ì˜¨ ê²½ìš°ë„ dirty í•´ì œ
  const params = new URLSearchParams(window.location.search);
  if (params.get("saved") === "1") dirty = false;

  window.addEventListener("beforeunload", (e) => {
    if (!dirty) return;
    e.preventDefault();
    e.returnValue = "";
  });
})();
</script>

</body>
</html>
